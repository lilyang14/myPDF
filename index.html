<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>个人作品集</title>
  
  <!-- 网站图标配置 -->
  <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
  <link rel="manifest" href="favicon_io/site.webmanifest">
  <link rel="mask-icon" href="favicon_io/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#1C1C1C">

  <style>
    /* ==========================================
       基础配置 & 变量定义
    ========================================== */
    :root {
      --color-white: #FFF;
      --color-bg-main: #1C1C1C;
      --opacity-modal-bg: 0.8;    /* 更新：弹窗背景透明度 80% */
      --opacity-modal-border: 0.2; /* 更新：弹窗边框透明度 20% */
      --transition-base: 0.2s ease;
      --transition-fade: 0.5s ease;
    }

    /* ==========================================
       全局重置 & 基础样式
    ========================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--color-bg-main);
      padding-top: 60px;
      min-height: 100vh;
      font-family: "PingFang SC", sans-serif;
    }

    /* ==========================================
       图片容器 & 加载状态
    ========================================== */
    .image-container {
      margin: 0 auto;
      width: 100%;
      max-width: 1200px;
      min-height: calc(100vh - 60px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .loading-wrapper {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }

    .loading-spinner {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 6px solid var(--color-white);
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }

    .loading-text {
      color: var(--color-white);
      font-size: 14px;
      font-weight: 400;
      line-height: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ==========================================
       作品图片样式
    ========================================== */
    .work-image {
      width: 100%;
      height: auto;
      display: block;
      opacity: 0;
      transition: opacity var(--transition-fade);
    }

    .work-image.loaded {
      opacity: 1;
    }

    /* ==========================================
       响应式适配
    ========================================== */
    @media (min-width: 768px) {
      .image-container {
        width: 65%;
      }
    }

    /* ==========================================
       异常提示弹窗（严格匹配最新样式要求）
    ========================================== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .modal-content {
      /* Layout 严格匹配 */
      display: flex;
      padding: 32px 40px 28px 40px;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      /* Style 严格匹配 */
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, var(--opacity-modal-border));
      background: rgba(0, 0, 0, var(--opacity-modal-bg));
    }

    .modal-text {
      /* 弹窗文案样式严格匹配 */
      color: var(--color-white);
      font-family: "PingFang SC";
      font-size: 14px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px; /* 142.857% */
    }

    .modal-btn {
      /* 弹窗按钮样式严格匹配 */
      display: flex;
      height: 36px;
      padding: 10px 20px;
      justify-content: center;
      align-items: center;
      gap: 4px;
      border-radius: 8px;
      background: var(--color-white);
      border: none;
      color: var(--color-bg-main);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: opacity var(--transition-base);
    }

    .modal-btn:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <!-- 图片展示容器 -->
  <div class="image-container" id="imageContainer">
    <!-- 加载状态容器 -->
    <div class="loading-wrapper" id="loadingWrapper">
      <div class="loading-spinner"></div>
      <p class="loading-text">加载中</p>
    </div>
  </div>

  <!-- 异常提示弹窗 -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <p class="modal-text" id="modalText"></p>
      <button class="modal-btn" id="modalBtn"></button>
    </div>
  </div>

  <script>
    // ==========================================
    // 配置常量（统一管理，便于维护）
    // ==========================================
    const CONFIG = {
      MAX_IMAGES: 50,          // 最大图片数量
      IMAGE_PREFIX: 'images/work', // 图片路径前缀
      IMAGE_SUFFIX: '.webp',   // 图片后缀
      MODAL_TEXT: {
        NO_CONTENT: '⚠️ 当前暂无内容，请刷新~',
        NETWORK_ERROR: '⚠️ 网络异常，请重新加载~',
        IMAGE_ERROR: '⚠️ 图片加载失败，请重新加载~'
      },
      MODAL_BTN_TEXT: {
        REFRESH: '刷新',
        RELOAD: '重新加载'
      }
    };

    // ==========================================
    // DOM元素缓存（避免重复查询DOM）
    // ==========================================
    const DOM = {
      imageContainer: document.getElementById('imageContainer'),
      loadingWrapper: document.getElementById('loadingWrapper'),
      modal: document.getElementById('modal'),
      modalText: document.getElementById('modalText'),
      modalBtn: document.getElementById('modalBtn')
    };

    // 存储有效图片URL
    let validImageUrls = [];

    // ==========================================
    // 工具函数（通用功能封装）
    // ==========================================
    /**
     * 显示弹窗提示
     * @param {string} text 弹窗文案
     * @param {string} btnText 按钮文字
     */
    const showModal = (text, btnText) => {
      DOM.modalText.textContent = text;
      DOM.modalBtn.textContent = btnText;
      DOM.modal.style.display = 'flex';
      // 绑定按钮点击事件（移除旧事件避免重复绑定）
      DOM.modalBtn.onclick = () => window.location.reload();
    };

    /**
     * 隐藏加载状态并恢复容器布局
     */
    const hideLoading = () => {
      DOM.loadingWrapper.style.display = 'none';
      DOM.imageContainer.style.minHeight = 'auto';
      DOM.imageContainer.style.justifyContent = 'flex-start';
    };

    // ==========================================
    // 核心业务逻辑
    // ==========================================
    /**
     * 检测图片是否存在（HEAD请求，轻量高效）
     * @param {string} url 图片URL
     * @returns {Promise<boolean>} 是否存在
     */
    const checkImageExists = async (url) => {
      try {
        const response = await fetch(url, {
          method: 'HEAD',
          cache: 'no-cache'
        });
        return response.ok;
      } catch (err) {
        return false;
      }
    };

    /**
     * 收集所有有效图片URL
     */
    const collectValidImages = async () => {
      try {
        // 批量检测图片，按顺序收集有效URL
        for (let i = 1; i <= CONFIG.MAX_IMAGES; i++) {
          const imageUrl = `${CONFIG.IMAGE_PREFIX}${i}${CONFIG.IMAGE_SUFFIX}`;
          const isExists = await checkImageExists(imageUrl);
          
          if (isExists) {
            validImageUrls.push(imageUrl);
          } else {
            // 命名连续，某张不存在则后续都不存在，终止检测
            break;
          }
        }

        // 隐藏加载状态
        hideLoading();

        // 无有效图片时显示弹窗
        if (validImageUrls.length === 0) {
          showModal(CONFIG.MODAL_TEXT.NO_CONTENT, CONFIG.MODAL_BTN_TEXT.REFRESH);
          return;
        }

        // 渲染图片
        renderImages();
      } catch (err) {
        // 网络异常处理
        hideLoading();
        showModal(CONFIG.MODAL_TEXT.NETWORK_ERROR, CONFIG.MODAL_BTN_TEXT.RELOAD);
        console.error('收集图片失败：', err);
      }
    };

    /**
     * 渲染图片到页面（前10张立即加载，后续懒加载）
     */
    const renderImages = () => {
      validImageUrls.forEach((url, index) => {
        const img = document.createElement('img');
        
        // 基础属性配置
        img.src = url;
        img.alt = `作品 ${index + 1}`;
        img.className = 'work-image';
        img.draggable = false; // 禁止拖拽
        
        // 懒加载配置（前10张立即加载）
        if (index >= 10) {
          img.loading = 'lazy';
        }

        // 图片加载完成 - 淡入显示
        img.onload = () => img.classList.add('loaded');
        
        // 图片加载失败 - 显示弹窗（防抖：只触发一次）
        img.onerror = () => {
          if (!DOM.modal.style.display) {
            showModal(CONFIG.MODAL_TEXT.IMAGE_ERROR, CONFIG.MODAL_BTN_TEXT.RELOAD);
          }
        };

        DOM.imageContainer.appendChild(img);
      });
    };

    /**
     * 图片版权保护（禁止右键/拖拽）
     */
    const protectImages = () => {
      // 禁止右键点击图片
      document.addEventListener('contextmenu', (e) => {
        if (e.target.tagName === 'IMG') e.preventDefault();
      });

      // 禁止拖拽图片
      document.addEventListener('dragstart', (e) => {
        if (e.target.tagName === 'IMG') e.preventDefault();
      });
    };

    // ==========================================
    // 初始化 & 事件监听
    // ==========================================
    const init = () => {
      // 启用图片保护
      protectImages();

      // 页面加载完成后滚动到顶部
      window.addEventListener('load', () => {
        window.scrollTo({ top: 0, behavior: 'instant' });
      });

      // 监听网络离线事件
      window.addEventListener('offline', () => {
        hideLoading();
        showModal(CONFIG.MODAL_TEXT.NETWORK_ERROR, CONFIG.MODAL_BTN_TEXT.RELOAD);
      });

      // 收集并渲染图片
      collectValidImages();
    };

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
